{% extends "base.html" %}

{% load as_vertical_form from bootstrap %}
{% load widget_tweaks %}
{% load comments %}


{% block header %}

  {% with headerMessage='Talk Page' %}
  {% include "includes/header.html" %}
  {% endwith %}

  <nav role='navigation' class="navbar navbar-default navbar-static-top">
    <!-- .container&#45;fluid -->
    <!--   .row -->
    <!--     .col&#45;xs&#45;12 -->
    <!--       h3 -->
    <!--         <a href="javascript:window.open('','_self').close();"><i class="fa fa&#45;angle&#45;double&#45;left"></i> Back to Marking</a> -->
  </nav>

{% endblock header %}


{% block content %}
<div class="container-fluid content talk">

  <div class="row">
    <div class="col-10">
      <h4 class="text-xs-center">{{ doc }}</h4>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <ul role='tablist' class="nav nav-tabs">
        <li class="nav-item">
          <a data-toggle="tab" href="#er-results" role="tab" class="nav-link active">
            Entity Recognition
          </a>
        </li>
        <li class="nav-item">
          <a data-toggle="tab" href="#r-results" role="tab" class="nav-link">
            Relation
          </a>
        </li>
        <li class="nav-item">
          <a href='http://www.ncbi.nlm.nih.gov/pubmed/{{doc.document_id}}' target='_blank' class="nav-link">
            PubMed  <i class="fa fa-external-link"></i>
          </a>
        </li>
      </ul>
    </div>
  </div>

  <div class="tab-content">
    <div id="er-results" role="tabpanel" class="tab-pane active">
      <div class="row m-t-1">
        <div class="col-xs-10 col-xs-offset-1">
          <p class="text-muted"> Mouseover to see other users' annotations:</p>
          <ul class="pagination">
            {% for user_pk in doc.contributors %}
            <li class="page-item">
              <a data-userpk='{{user_pk}}') class="page-link"> {{user_pk}}</a>
            </li>
            {% endfor %}
          </ul>

          <div class="paragraphs micro"></div>

          <div id="r-results" role="tabpanel" class="tab-pane">
            <div class="row mt-1" style='min-height: 300px;'>
              <div class="col-xs-10">
                <div id="relation-synopsis-insert"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">

      <div class="row mt-1">
        <div class="col-sm-6">
          <div class="row">

            <div class="col-4">
              <h4 class="text-center">Diseases</h4>
              <table class="table table-condensed table-striped">
                <thead>
                  <tr>
                    <th></th>
                    <th>Annotation</th>
                  </tr>
                </thead>
                <tbody>
                  {% for disease in diseases %}
                  <tr>
                    <th scope="row">{{disease.1}}</th>
                    <td>
                      <a href='/talk/annotation/?q={{disease.0}}'>
                        {{disease.0}}
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <div class="col-4">
              <h4 class="text-center"> Genes</h4>
              <table class="table table-condensed table-striped">
                <thead>
                  <tr>
                    <th></th>
                    <th>Annotation</th>
                  </tr>
                </thead>
                <tbody>
                  {% for gene_protein in gene_proteins %}
                  <tr>
                    <th scope="row">{{gene_protein.1}}</th>
                    <td>
                      <a href='/talk/annotation/?q={{gene_protein.0}}'>
                        {{gene_protein.0}}
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <div class="col-4">
              <h4 class="text-center" Drugs</h4>
              <table class="table table-condensed table-striped">
                <thead>
                  <tr>
                    <th></th>
                    <th>Annotation</th>
                  </tr>
                </thead>
                <tbody>
                  {% for drug in drugs %}
                  <tr>
                    <th scope="row">{{drug.1}}</th>
                    <td>
                      <a href='/talk/annotation/?q={{drug.0}}'>
                        {{drug.0}}
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                <tbody>
              </table>
            </div>

          </div>

            <div class="col-6">
              <div class="row">
                <div class="col-xs-12">
                {% get_comment_list for document.document doc.pk as comment_list %}
                <div class="list-group">
                  {% for comment in comment_list %}
                  <div class="list-group-item">
                    <h4 class="list-group-item-heading">
                      <a href='{% url "userprofile:public-profile" comment.user.username %}'>
                        {{ comment.user.username }}
                      </a>
                    </h4>
                    <p class="list-group-item-text"> {{ comment.comment }}</p>
                    <p class="text-right text-muted">
                      <small>{{ comment.submit_date }}</small>
                    </p>
                  </div>
                  {% endfor %}
                </div>
              {% endblock %}
              </div>
            </div>

            <div class="row justify-content-center">
              <div class="col-10">
                {% get_comment_form for document.document doc.pk as form %}
                <form action="{% comment_form_target %}" method="post">
                  {{csrf_token}}

                  <fieldset>
                    {{ form.timestamp }}
                    {{ form.content_type }}
                    {{ form.object_pk }}
                    {{ form.security_hash }}

                    {{ form.comment|as_vertical_form }}
                    <input type="hidden" name="next" value="{% url 'talk:home' doc.document_id %}" />
                  </fieldset>

                  <fieldset>
                    <input type="submit" name="submit" value="Post" class="btn btn-primary pull-right" />
                  </fieldset>
                </form>
                {% endblock %}

                </div>
              </div>
            </div>

{% endblock %}
